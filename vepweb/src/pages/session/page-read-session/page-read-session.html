<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/kwc-i18n/kwc-i18n.html">
<link rel="import" href="/bower_components/google-map/google-map.html">
<link rel="import" href="/bower_components/google-map/google-map-marker.html">
<link rel="import" href="/bower_components/google-map/google-map-search.html">
<link rel="import" href="/bower_components/kwc-date-format/kwc-date-format.html">
<link rel="import" href="/dist/elements/theater/show-plan/show-plan.html">
<link rel="import" href="/dist/elements/on-granted/on-granted.html">
<link rel="import" href="/dist/elements/session/session-reservations/session-reservations.html">
<link rel="import" href="/dist/lib/vep/services/theater-service/theater-service.html">
<link rel="import" href="/dist/lib/vep/services/show-service/show-service.html">
<link rel="import" href="/dist/lib/vep/services/session-service/session-service.html">

<dom-module id="page-read-session">
  <template>
    <style>
      google-map {
        height: 250px;
      }

      .row {
        display: flex;
      }

      .column {
        flex-grow: 1;
      }

      .reserve {
        text-decoration: none;
        display: block;
        text-align: center;
        margin-top: 1rem;
      }

      .reserve>div {
        border: 1px solid transparent;
        text-decoration: none;
        padding: 0.85em 1em;
        background-color: #2199e8;
        color: #fefefe;
      }
    </style>

    <h1>[[session.name]]
      <small>
        <kwc-date-format date="[[session.date]]" format="dddd DD MMMM YYYY [Ã ] HH:mm"></kwc-date-format>
      </small>
    </h1>

    <div class="row">
      <div class="column">
        <h3>
          <kwc-i18n key="page-read-session.shows.title" show></kwc-i18n>
        </h3>

        <ul>
          <template is="dom-repeat" items="[[session.shows]]" as="show">
            <li><a href="/show/read/[[show.canonical]]">[[show.title]]</a></li>
          </template>
        </ul>

        <h3>Liste des prix</h3>

        <ul>
          <template is="dom-repeat" items="[[session.prices]]" as="price">
            <li>
              <strong>[[price.name]]</strong> :
              [[price.price]] &euro;
              <span hidden$="[[!price.condition]]">([[price.condition]])</span>
            </li>
          </template>
        </ul>
      </div>
      <div class="column">
        <h3>
          <kwc-i18n key="page-read-session.theater.title" show></kwc-i18n>
        </h3>

        <kwc-i18n key="page-read-session.theater.description" show p1="[[theater.name]]"></kwc-i18n>

        <google-map-search map="[[map]]" query="[[theater.address]]" id="gmapSearch"></google-map-search>
        <google-map map="{{map}}" latitude="[[_theaterPlace.latitude]]" longitude="[[_theaterPlace.longitude]]"
                    api-key="AIzaSyC54D9PP_qz3xZTcZ6XeEULegzG5GATThE" zoom="15">
          <google-map-marker latitude="[[_theaterPlace.latitude]]"
                             longitude="[[_theaterPlace.longitude]]"></google-map-marker>
        </google-map>
      </div>
    </div>

    <div class="row">
      <div class="column">
        <template is="dom-if" if="[[session.canReserve]]">
          <a href="[[session.reservationURL]]" class="reserve">
            <div class="btn-reserve"><kwc-i18n key="page-read-session.reserve" show></kwc-i18n></div>
            <show-plan json-plan="[[theater.plan]]" reserved-seats="[[reservedSeats]]"></show-plan>
            <div class="btn-reserve"><kwc-i18n key="page-read-session.reserve" show></kwc-i18n></div>
          </a>
        </template>
        <template is="dom-if" if="[[!session.canReserve]]">
          <show-plan json-plan="[[theater.plan]]" reserved-seats="[[reservedSeats]]"></show-plan>
        </template>
      </div>
    </div>

    <on-granted roles="session-manager" block>
      <session-reservations theater="[[theaterCanonical]]" session="[[sessionCanonical]]"></session-reservations>
    </on-granted>
  </template>

  <script src="./page-read-session.js" inline></script>
</dom-module>